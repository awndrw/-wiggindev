name: Get Packages
description: Gets the packages and returns them to use in a matrix

outputs:
    packages:
        description: Array of packages
        value: ${{ steps.get.outputs.packages }}

runs:
    using: composite
    steps:
        - name: Checkout
          uses: actions/checkout@v3

        - name: Setup NodeJS
          uses: actions/setup-node@v3
          with:
              node-version: '18.x'
              cache: 'yarn'

        - name: Install Dependencies
          run: yarn install --immutable --immutable-cache --check-cache
          shell: bash

        - name: Enable Corepack
          run: corepack enable && yarn -v
          shell: bash

        - name: Get contents
          id: get
          shell: python
          run: |
              import os, json
              packages=os.listdir('packages')
              jsonPackages=json.dumps(packages)
              print(f'::set-output name=packages::{jsonPackages}')
              os.system('echo "## Packages Loaded" >> $GITHUB_STEP_SUMMARY')
              os.system('echo "" >> $GITHUB_STEP_SUMMARY')
              for package in packages:
                  os.system(f'echo "- {package}" >> $GITHUB_STEP_SUMMARY')
